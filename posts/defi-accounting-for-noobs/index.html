<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Beancount: DeFi Accounting For Noobs" /><meta property="og:locale" content="en" /><meta name="description" content="Disclaimer While it should be common sense, just in case someone doesn‚Äôt understand this: you should not blindly listen to a post on the internet on how to pay your taxes, do accounting, or even trade for that matter. Doing any of those actions wrong may result in you harming your finances and/or becoming legally liable if you e.g. misstate your income on tax forms. I‚Äôm neither a professional accountant, tax advisor nor lawyer. The content of this post is meant to be educational and should not be considered professional advice of any kind. If you intend to apply anything from this post do so at your own risk and consult a professional as this post almost definitely contains errors and oversimplifications." /><meta property="og:description" content="Disclaimer While it should be common sense, just in case someone doesn‚Äôt understand this: you should not blindly listen to a post on the internet on how to pay your taxes, do accounting, or even trade for that matter. Doing any of those actions wrong may result in you harming your finances and/or becoming legally liable if you e.g. misstate your income on tax forms. I‚Äôm neither a professional accountant, tax advisor nor lawyer. The content of this post is meant to be educational and should not be considered professional advice of any kind. If you intend to apply anything from this post do so at your own risk and consult a professional as this post almost definitely contains errors and oversimplifications." /><link rel="canonical" href="https://philogy.github.io/posts/defi-accounting-for-noobs/" /><meta property="og:url" content="https://philogy.github.io/posts/defi-accounting-for-noobs/" /><meta property="og:site_name" content="Philogy‚Äôs blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-01T20:45:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Beancount: DeFi Accounting For Noobs" /><meta name="twitter:site" content="@real_philogy" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-10-01T21:06:57+02:00","datePublished":"2023-10-01T20:45:00+02:00","description":"Disclaimer While it should be common sense, just in case someone doesn‚Äôt understand this: you should not blindly listen to a post on the internet on how to pay your taxes, do accounting, or even trade for that matter. Doing any of those actions wrong may result in you harming your finances and/or becoming legally liable if you e.g. misstate your income on tax forms. I‚Äôm neither a professional accountant, tax advisor nor lawyer. The content of this post is meant to be educational and should not be considered professional advice of any kind. If you intend to apply anything from this post do so at your own risk and consult a professional as this post almost definitely contains errors and oversimplifications.","headline":"Beancount: DeFi Accounting For Noobs","mainEntityOfPage":{"@type":"WebPage","@id":"https://philogy.github.io/posts/defi-accounting-for-noobs/"},"url":"https://philogy.github.io/posts/defi-accounting-for-noobs/"}</script><title>Beancount: DeFi Accounting For Noobs | Philogy's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Philogy's blog"><meta name="application-name" content="Philogy's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/bootstrap-4.6.1/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free-5.15.4/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup-1.1.0/magnific-popup.css"> <script src="/assets/lib/jquery-3.6.0/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/headshot.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Philogy's blog</a></div><div class="site-subtitle font-italic">Phil's ideas & research.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Philogy" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/real_philogy" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['philippe','dumo.net'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Beancount: DeFi Accounting For Noobs</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Beancount: DeFi Accounting For Noobs</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1696185900" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 1, 2023 </em> </span> <span> Updated <em class="" data-ts="1696187217" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 1, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="/about">Philippe Dumonet</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8055 words"> <em>44 min</em> read</span></div></div></div><div class="post-content"><blockquote class="prompt-warning"><div><p><strong>Disclaimer</strong></p><p>While it should be common sense, just in case someone doesn‚Äôt understand this: you <strong>should not</strong> blindly listen to a post on the internet on how to pay your taxes, do accounting, or even trade for that matter. Doing any of those actions wrong may result in you harming your finances and/or becoming legally liable if you e.g. misstate your income on tax forms. I‚Äôm neither a professional accountant, tax advisor nor lawyer. The content of this post is meant to be educational and should not be considered professional advice of any kind. If you intend to apply anything from this post do so at your own risk and consult a professional as this post almost definitely contains errors and oversimplifications.</p></div></blockquote><h2 id="intro"><span class="mr-2">Intro</span><a href="#intro" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This blog post will give you a practical introduction to accounting in the context of DeFi.</p><p>I‚Äôve created this post to share some of my learnings as an amateur, self-taught bookkeeper and expand the community of accounting-interested DeFi users. Hopefully, I can help some of you with your daily crypto / DeFi trading activities. üòÑ</p><h2 id="reasons-to-learn-basic-accounting"><span class="mr-2">Reasons To Learn Basic Accounting</span><a href="#reasons-to-learn-basic-accounting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Before diving into the actual content I wanted to lay out some reasons why you might want to learn the basics of accounting if you‚Äôre not already motivated / interested. If you already know why you want to learn feel free to skip to the next <a href="/posts/defi-accounting-for-noobs/#-crypto-tax-software--when-to-get-help-from-experts">section</a>.</p><ul><li>Tax Compliance ü•∏: If you want to easily and accurately determine your income you need a consistent system<li>Tax Avoidance üòé: If you want to save on taxes you need to understand your tax laws and how you can legally leverage them to your benefit<li>Insight &amp; Understanding üìä: Accounting allows you to notice and quantify trends in your finances as well as understand how you‚Äôre spending and earning it if you want to be able to optimize something you have to be able to measure it first<li>Unique mental model üß†: If you‚Äôre a DeFi smart contract developer or auditor understanding the basics of financial accounting can give you a unique way of modeling value changes and transactions in protocols, adding another useful mental model to apply to protocols.</ul><h3 id="the-downsides-of-an-external-accountant"><span class="mr-2">The Downsides Of An External Accountant</span><a href="#the-downsides-of-an-external-accountant" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>While you could hire an accountant to do everything for you, unless you have a pretty sizable net worth it will hardly be worth the cost. Most accountants are not familiar with crypto let alone obscure DeFi protocols. If your activity consists of more than just basic spot trades you‚Äôll likely have to spend time, money, and effort explaining to a normal accountant how the different DeFi protocols, farms, NFTs, and airdrops work.</p><p><img data-src="/assets/images/confused-accountant-meme.jpg" alt="Confused math lady meme with the caption &quot;Your accountant trying to understand how you made y-figures off food coins&quot;" data-proofer-ignore></p><p>Furthermore not having direct control of your ‚Äúbooks‚Äù (accounting lingo for where all your transactions, inventory, etc. are kept track of) limits your ability to optimize your taxes, making you completely reliant on advice from your accountant or other advisors.</p><h2 id="-crypto-tax-software--when-to-get-help-from-experts"><span class="mr-2">üíº Crypto Tax Software &amp; When To Get Help From Experts</span><a href="#-crypto-tax-software--when-to-get-help-from-experts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>While this whole post is about accounting basics and how to easily keep track of one‚Äôs books there are situations where you can and probably <strong>should consult</strong> with an expert. When it comes to filing tax statements for your yearly/quarterly reporting or better understanding the tax laws and how they apply to your specific situation you should definitely consult professionals.</p><p>In fact, if you‚Äôre just doing basic trades on exchanges and the popular DeFi protocols you should probably just use one of the many existing crypto tax software. They‚Äôll save you a lot of effort by automating the importing and classification of transactions.</p><p>My approach is to do the accounting myself while consulting a tax advisor on the general laws and how they might apply to my situation. When it comes time to report my taxes I also compile a bunch of summaries from my accounting and hand it over to the tax advisor for them to double-check and submit the necessary tax statements in a proper manner.</p><h2 id="-beancount"><span class="mr-2">ü´ò Beancount</span><a href="#-beancount" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Beancount is an open-source, easy-to-use text-based accounting tool. Unlike commercial accounting programs, its base feature set is relatively limited. While this may sound like a downside I think this is actually very useful as it makes it easy to use without getting distracted by overviews, charts, and features I don‚Äôt need.</p><p>While Beancount is simple at its core you <em>can</em> choose to make it as sophisticated as you want by installing and/or writing your own plugins or by simply leveraging the command-line tools that come along with beancount. Beancount has a very nice API making it easy to extend with Python.</p><p>Furthermore, as part of its core feature set, it has some very nice handling of inventory or as it prefers to call it in its <a href="https://beancount.github.io/docs/">documentation</a> ‚Äúcommodities‚Äù. While not specifically made for crypto it‚Äôs very well suited for accounting crypto transactions.</p><h3 id="installation"><span class="mr-2">Installation</span><a href="#installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Installing <code class="language-plaintext highlighter-rouge">beancount</code> is very simple, but it requires you to have Python and its package manager <code class="language-plaintext highlighter-rouge">pip</code> already installed. If you don‚Äôt have those already I‚Äôd recommend just doing a quick search ‚Äúhow to install python and pip on (windows / mac / linux)‚Äù. If you‚Äôre on a Linux distro, Python and pip may already be installed so just check. Once <code class="language-plaintext highlighter-rouge">pip</code> is installed you can install <code class="language-plaintext highlighter-rouge">beancount</code> by running the following in a command line:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pip <span class="nb">install </span>beancount <span class="c"># or pip3 install beancount</span>
</pre></table></code></div></div><p>Next to beancount I‚Äôd highly recommend also installing the <a href="https://beancount.github.io/fava/"><code class="language-plaintext highlighter-rouge">fava</code> web interface for beancount</a>. It allows you to have a visual interface in your browser to see your finances and even allows you to make basic entries. To install fava run <code class="language-plaintext highlighter-rouge">pip install fava</code>.</p><h3 id="Ô∏è-editing-files"><span class="mr-2">‚úèÔ∏è Editing Files</span><a href="#Ô∏è-editing-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Beancount and the CLI (command line) tools that come installed with it are mainly there to help you gain insight and create summaries based on your entries. Beancount entries are tracked in <code class="language-plaintext highlighter-rouge">.beancount</code> files which are created and edited manually, the <code class="language-plaintext highlighter-rouge">.beancount</code> format is a simple, human-readable text format for accounting financial data. For editing such files I‚Äôd highly recommend using an editor like <a href="https://code.visualstudio.com/">VS Code</a>, while it‚Äôs typically used by programmers note you don‚Äôt need to know how to code to be able to use beancount.</p><p>If you choose to go with VS Code you should install the Beancount plugin, it‚Äôll give you syntax highlighting, auto alignment, auto-completion, and more to make it even easier to manage your entries.</p><p><img data-src="/assets/images/beancount-vscode-plugin.png" alt="Beancount VS Code Plugin" data-proofer-ignore></p><h2 id="-accounting-basics-double-entry-bookkeeping"><span class="mr-2">üìö Accounting Basics: Double-Entry Bookkeeping</span><a href="#-accounting-basics-double-entry-bookkeeping" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we‚Äôve installed the tool I‚Äôll be demonstrating the accounting concepts, how they relate to crypto / DeFi accounting and how to apply them using beancount.</p><h3 id="Ô∏èyour-first-ledger"><span class="mr-2">üóíÔ∏èYour First Ledger</span><a href="#Ô∏èyour-first-ledger" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Your ‚Äúledger‚Äù or ‚Äúbooks‚Äù is the central store of all your transactions. In beancount it‚Äôs a set of files with the <code class="language-plaintext highlighter-rouge">.beancount</code> extension. Let‚Äôs go ahead and create our first ledger, I‚Äôll call it <code class="language-plaintext highlighter-rouge">Main.beancount</code> but the name doesn‚Äôt really matter:</p><p><img data-src="/assets/images/beancount-ledger-creation.png" alt="Beancount VS Code Plugin" data-proofer-ignore></p><p>If you just want to make a small note or remark for yourself you can add a so-called comment by prepending the line with a semi-colon <code class="language-plaintext highlighter-rouge">;</code>:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>; This is a comment
; Doesn't matter what I say here beancount won't recognize it and it won't break my file!
</pre></table></code></div></div><p>Next you‚Äôll want to specify your base currency, unless you‚Äôre a DAO that wants to do its accounting in a stablecoin or crypto coin like ETH or BTC you should pick your the fiat currency you use day-to-day and report your taxes in. While I don‚Äôt live in the US for the sake of this post I‚Äôll go with US-Dollars:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>; Defines the base currency (remember this is a comment):
option "operating_currency" "USD"
</pre></table></code></div></div><p>Now that the bare basics are set up you can start <code class="language-plaintext highlighter-rouge">fava</code> by opening a terminal and running <code class="language-plaintext highlighter-rouge">fava Main.beancount</code> in the folder your ledger is in:</p><p><img data-src="/assets/images/beancount-fava-started.png" alt="Fava started in VS Code terminal" data-proofer-ignore></p><p>You can then go to the shown address (likely <code class="language-plaintext highlighter-rouge">https://localhost:5000</code>) in your browser to get a visual overview of what you‚Äôre changing, but ignore it for now because your ledger is empty.</p><h3 id="transactions--accounts"><span class="mr-2">Transactions &amp; Accounts</span><a href="#transactions--accounts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In double entry accounting, a transaction is recorded anytime an event persistently changes your finances e.g.:</p><ul><li>A cash transfer from one bank account to another<li>Purchase of an item with a credit card<li>Receiving a bill<li>Buying 100$ worth of ETH<li>Receiving interest<li>Paying a bill you received 2 months ago</ul><p>The ‚Äúreceiving bill‚Äù example may be an unintuitive one, how does ‚Äúreceiving a bill‚Äù affect my finances? Well when you receive a bill you‚Äôre being made aware of money you now owe someone. While this post is aimed at DeFi accounting these examples are meant to demonstrate what transactions roughly represent in the double-entry accounting framework.</p><p>Let‚Äôs add a simple transaction to our ledger denoting a $500 transfer from a ‚ÄúBank A‚Äù to ‚ÄúBank B‚Äù:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>2022-12-18 *
    Assets:Bank-A                              -500.00 USD
    Assets:Bank-B                               500.00 USD
</pre></table></code></div></div><p>A transaction in beancount starts with a date in iso format <code class="language-plaintext highlighter-rouge">&lt;year&gt;-&lt;month&gt;-&lt;day&gt;</code> and a <code class="language-plaintext highlighter-rouge">*</code>. It‚Äôs then followed by rows of postings, which each posting affecting a specific account. You can also add an optional ‚Äúpayee‚Äù and ‚Äúnarration‚Äù explaining where and what you‚Äôre doing, they must be in quotes. For example:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>2022-12-18 * "JP Morgan" "Rebalancing to my Chase account"
    Assets:Bank-A                              -500.00 USD
    Assets:Bank-B                               500.00 USD
</pre></table></code></div></div><p>This will help you later understand what a transaction is and why it was done so it‚Äôs highly recommended you add at least narration to your transactions. The payee and narration must always be in quotes <code class="language-plaintext highlighter-rouge">"</code>.</p><p>If you‚Äôve saved your file and have the VS Code plugin or fava running you‚Äôll notice they‚Äôre complaining about errors in your ledger file (note I have relative line numbers on which is why they look weird on my end): <img data-src="/assets/images/beancount-invalid-reference-error.png" alt="Fava started in VS Code terminal" data-proofer-ignore></p><p>This happens because beancount needs you to define the accounts you‚Äôre going to use, this requirement helps you easily catch typos later. To define an account use the ‚Äúopen‚Äù directive, the errors should disappear:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>2022-12-18 open Assets:Bank-A
2022-12-18 open Assets:Bank-B

2022-12-18 * "JP Morgan" "Rebalancing to my Chase account"
    Assets:Bank-A                              -500.00 USD
    Assets:Bank-B                               500.00 USD
</pre></table></code></div></div><p>You can call accounts whatever you‚Äôd like, colons <code class="language-plaintext highlighter-rouge">:</code> in the name are similar to the slashes <code class="language-plaintext highlighter-rouge">/</code> in file paths, they denote ‚Äúparent‚Äù accounts, like folders allowing you to group together related accounts:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>2020-12-18 open Assets:Cash:JPM:Savings
2020-12-18 open Assets:Cash:JPM:Checking
2020-12-18 open Assets:Cash:BofA
2021-03-11 open Assets:Crypto:Tokens
2021-03-11 open Assets:Crypto:Stables
</pre></table></code></div></div><div file="Account Tree" class="language-ml highlighter-rouge"><div class="code-header"> <span data-label-text="Account Tree"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">//</span> <span class="n">running</span> <span class="n">`bean-report</span> <span class="nn">Main</span><span class="p">.</span><span class="n">beancount</span> <span class="n">accounts</span> <span class="p">|</span> <span class="n">treeify`</span>
<span class="n">--</span> <span class="n">Assets</span>
   <span class="n">|--</span> <span class="n">Cash</span>
   <span class="p">|</span>   <span class="n">|--</span> <span class="n">BofA</span>
   <span class="p">|</span>   <span class="n">|--</span> <span class="n">JPM</span>
   <span class="p">|</span>       <span class="n">|--</span> <span class="n">Checking</span>
   <span class="p">|</span>       <span class="n">|--</span> <span class="n">Savings</span>
   <span class="n">|--</span> <span class="n">Crypto</span>
       <span class="n">|--</span> <span class="n">Stables</span>
       <span class="n">|--</span> <span class="n">Tokens</span>
</pre></table></code></div></div><p>Transactions can have more than two postings however, meaning you can express transactions that change more than 1 account:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>; Opening (doesn't have to on the same day)
2022-12-18 open Assets:Cash:Bank-A
2022-12-18 open Assets:Cash:Physical
2022-12-18 open Expenses:Fees:Bank-A:ATM

; Transaction
2022-12-18 * "Bank A" "ATM Withdrawal"
    Assets:Cash:Bank-A                       -502.20 USD
    Assets:Cash:Physical                      500.00 USD
    Expenses:Fees:Bank-A:ATM                    2.20 USD
</pre></table></code></div></div><h3 id="-balance"><span class="mr-2">ü™® Balance</span><a href="#-balance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A core rule of double-entry accounting which is also strictly enforced in beancount is that <strong>all transactions must balance</strong>. Specifically they must balance to zero. It‚Äôs this rule combined with the use of different account types that makes double-entry accounting so powerful. It ensures that everything is kept track of in some way or another, if you create a transaction that doesn‚Äôt balance beancount will give you an error.</p><p>However to make your life easier beancount allows you to omit the value of one posting and will balance the transaction for you automatically:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>; Opening (doesn't have to on the same day)
2022-12-18 open Assets:Cash:Bank-A
2022-12-18 open Assets:Cash:Physical
2022-12-18 open Expenses:Fees:Bank-A:ATM

; Transaction
2022-12-18 * "Bank A" "ATM Withdrawal"
    Assets:Cash:Bank-A                       -502.20 USD
    Assets:Cash:Physical                      500.00 USD
    Expenses:Fees:Bank-A:ATM
</pre></table></code></div></div><p>You can check the filled in values in fava under ‚ÄúJournal‚Äù or by running <code class="language-plaintext highlighter-rouge">bean-report Main.beancount print</code> in your command line (<code class="language-plaintext highlighter-rouge">bean-report</code> is one of the CLI tools automatically installed alongside <code class="language-plaintext highlighter-rouge">beancount</code>).</p><h3 id="account-types"><span class="mr-2">Account Types</span><a href="#account-types" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If all transactions must balance then ‚Äúhow do I account for income, expenses, purchases from debt or even assets I already had when I started?‚Äù you may ask. That‚Äôs where the different account types come in.</p><p>In double-entry accounting, accounts are not only where money is (asset accounts) but also where it comes from (income accounts), where it went (expense accounts), where it‚Äôs going to go (liability accounts) and where it has come from in the past (equity accounts).</p><p>These 5 base types: <code class="language-plaintext highlighter-rouge">Assets</code>, <code class="language-plaintext highlighter-rouge">Income</code>, <code class="language-plaintext highlighter-rouge">Expenses</code>, <code class="language-plaintext highlighter-rouge">Liabilities</code> and <code class="language-plaintext highlighter-rouge">Equity</code> are also enforced by beancount. Any valid account name must start with one of these as its root.</p><h4 id="assets--liabilities"><span class="mr-2">Assets &amp; Liabilities</span><a href="#assets--liabilities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Assets and liabilities are opposites and the simplest account types. Asset are everything you have in your posession, even if you owe it to someone and liabilities are everything you owe someone. For example when you borrow $10,000.00 worth of coins on a lending protocol you‚Äôd book both assets and liabilities, because you‚Äôre both getting the tokens you‚Äôre borrowing but you‚Äôre creating debt:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>; Opening
2022-01-01 open Assets:Crypto:Tokens
2022-01-01 open Liabilities:Crypto

; Transaction
2022-03-01 * "Aave" "Borrow Tokens"
    Assets:Crypto:Tokens                   10,000.00 USD
    Income:Crypto:Interest                -10,000.00 USD
</pre></table></code></div></div><p>Similarly if you make a purchase from a credit card:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>; Opening
2022-01-01 open Liabilities:Credit-Cards:Mastercard-6969
2022-01-01 open Expenses:Living:Groceries

; Transaction
2022-06-01 * "Walmart" "Weekly food shopping"
    Liabilities:Credit-Cards:Mastercard-6969  -79.20 USD
    Expenses:Living:Groceries                  79.20 USD

</pre></table></code></div></div><h4 id="expenses--income"><span class="mr-2">Expenses &amp; Income</span><a href="#expenses--income" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Counterintuitively income accounts have a negative balance, this is because they‚Äôre a source of funds, meaning they‚Äôre deducted when used. If you do a lot of transactions with different DeFi protocols, maybe even some freelance work and/or have a fixed job, having a good breakdown of income types by keeping track of corresponding income accounts can give you a good overview of how you made your money. Similarly expense accounts give you insight into how your money is spent.</p><p>Here are two examples:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>; Opening
2022-01-01 open Assets:Crypto:Tokens
2022-01-01 open Assets:Cash:Bank-A
2022-01-01 open Income:Crypto:Interest
2022-01-01 open Income:Freelance:Consulting
2022-01-01 open Expenses:Fees:Stripe

; Transactions
2022-03-01 * "Aave" "Withdraw Interst"
    Assets:Crypto:Tokens                       30.00 USD
    Income:Crypto:Interest                    -30.00 USD

2022-03-01 * "Bob" "Payment for February"
    Income:Freelance:Consulting            -3,000.00 USD
    Assets:Cash:Bank-A                      2,972.23 USD
    Expenses:Fees:Stripe
</pre></table></code></div></div><h4 id="equity"><span class="mr-2">Equity</span><a href="#equity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Equity accounts are the weirdest account type, they basically represent what you‚Äôd have left over if you took all your assets and paid off your debts. They‚Äôre mainly used when you start a new ledger or ‚Äúclose a time period‚Äù. In accounting ‚Äúclosing‚Äù a time period basically means reseting the income &amp; expense accounts and moving any net profit / loss into equity:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>; Opening
2022-01-01 open Equity:Opening-Balances
2022-01-01 open Assets:Cash:Bank-A
2022-01-01 open Income:Crypto:Interest
2022-01-01 open Income:Freelance:Consulting
2022-01-01 open Expenses:Fees:Stripe

; Transactions
2022-01-01 * "Opening balances"


; inbetween transactions

2022-03-01 * "Bob" "Payment for February"
    Income:Freelance:Consulting            -3,000.00 USD
    Assets:Cash:Bank-A                      2,972.23 USD
    Expenses:Fees:Stripe
</pre></table></code></div></div><p>I‚Äôll go into closing a bit later.</p><p>Equity in total should be negative, if it‚Äôs positive it means you owe more than you have (Liabilities &gt; Assets) and are theoretically insolvent.</p><h2 id="-inventory-lots-and-booking-methods"><span class="mr-2">ü™ô Inventory, Lots and Booking Methods</span><a href="#-inventory-lots-and-booking-methods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="inventory--lots"><span class="mr-2">Inventory &amp; Lots</span><a href="#inventory--lots" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now that we‚Äôve covered the basics we can get into how to account crypto assets. You see the intuitive approach doesn‚Äôt work, while beancount accepts any type of currency for postings, not only the base currency we‚Äôve defined if we try to book a simple trade it‚Äôll give us an error:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>option "operating_currency" "USD"

2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:Tokens

2022-01-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -2,200.00 USD
    Assets:Crypto:Tokens                        2.00 ETH

</pre></table></code></div></div><p>Specifically beancount is telling us that <code class="language-plaintext highlighter-rouge">Transaction does not balance: (-2200.00 USD, 2.00 ETH)</code>. You see when you book assets in double-entry bookkeeping you book them at cost, like this the transaction balances in USD:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>2022-01-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -2,200.00 USD
    Assets:Crypto:Tokens                        2.00 ETH {1,100.00 USD, 2022-01-02}
</pre></table></code></div></div><p>The price and date are denoted in the curly braces after the asset. This tells beancount that while we‚Äôre getting <code class="language-plaintext highlighter-rouge">ETH</code> we‚Äôre just converting $2,200.00 into $2,200.00 worth of ETH so that the transaction balances. Similar to the postings auto-balance you can leave out the date and/or the price and beancount will automatically fill it in for you (if you‚Äôre only buying one asset):</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>2022-01-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -2,200.00 USD
    Assets:Crypto:Tokens                        2.00 ETH {}
</pre></table></code></div></div><p>Booking an asset or ‚Äúcommodity‚Äù as beancount likes to call it, like this creates a ‚Äúlot‚Äù. A lot is a single acquisition / coin in your inventory. As you do multiple purchases and sales you will accumulate different lots each with their own cost and date.</p><p>In beancount lots also have an optional label which I use for NFTs:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:NFTs

2022-03-02 * "NFT Purchase"
    Assets:Cash:Exchange-A                -10,000.00 USD
    Assets:Crypto:NFTs                          1 GOBBLER {2,000.00 USD, "id:401"}
    Assets:Crypto:NFTs                          1 GOBBLER {2,000.00 USD, "id:402"}
    Assets:Crypto:NFTs                          1 GOBBLER {2,000.00 USD, "id:403"}
    Assets:Crypto:NFTs                          1 GOBBLER {2,000.00 USD, "id:404"}
    Assets:Crypto:NFTs                          1 GOBBLER {2,000.00 USD, "id:405"}
</pre></table></code></div></div><p>The label has to be part of lot data in the curly braces, separated by a comma and in quotes. What‚Äôs in quotes is entirely up to you, I just like to use the <code class="language-plaintext highlighter-rouge">id:&lt;token ID&gt;</code> convention. While it‚Äôs very well suited for crypto you can also use beancount‚Äôs lot system for other assets:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Cash:Bank-A

2022-04-20 open Assets:Real-Estate
2022-04-20 open Liabilities:Mortgages:Home
2022-04-20 * "Closing the purchase of new home"
    Assets:Cash:Bank-A                    -50,000.00 USD
    Liabilities:Mortgages:Home           -450,000.00 USD
    Assets:Real-Estate                          1 PROPERTY {500,000.00 USD, "42th Avenue 69th Street, 10019 NY"}
</pre></table></code></div></div><p>If you want to see your full inventory you can go to fava under the <code class="language-plaintext highlighter-rouge">Holdings</code> tab. I don‚Äôt like that overview too much however so I made this custom query you can run under fava‚Äôs <code class="language-plaintext highlighter-rouge">Query</code> tab or using beancount‚Äôs <code class="language-plaintext highlighter-rouge">bean-query</code> tool:</p><div file="Get non-USD Lots Query" class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Get non-USD Lots Query"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">account</span><span class="p">,</span> <span class="n">cost_date</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">units</span><span class="p">(</span><span class="k">position</span><span class="p">))</span> <span class="k">as</span> <span class="n">units</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">cost</span><span class="p">(</span><span class="k">position</span><span class="p">))</span> <span class="k">as</span> <span class="n">cost_total</span><span class="p">,</span> <span class="n">cost_label</span> <span class="k">as</span> <span class="n">label</span>
<span class="k">WHERE</span> <span class="n">currency</span> <span class="o">!=</span> <span class="s1">'USD'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">currency</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">cost_date</span><span class="p">,</span> <span class="n">cost_label</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">account</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">cost_date</span>
</pre></table></code></div></div><h3 id="booking-methods"><span class="mr-2">Booking Methods</span><a href="#booking-methods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>(source)<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p><p>Now that we know how to book cryptocurrencies when we acquire we have to know how to dispose of them. The main problem or rather question here is in what order to you use your lots?</p><p>Consider the inventory resulting from the following purchases:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:Tokens
2022-01-01 open Assets:Crypto:NFTs

2022-01-02 * "Simple Trade"
  Assets:Cash:Exchange-A  -2200.00 USD
  Assets:Crypto:Tokens        2.00 ETH {1100 USD, 2022-01-02}

2022-03-02 * "Simple Trade"
  Assets:Cash:Exchange-A  -3300.00 USD
  Assets:Crypto:Tokens        1.50 ETH {2200 USD, 2022-03-02}

2022-06-02 * "Simple Trade"
  Assets:Cash:Exchange-A  -1200.00 USD
  Assets:Crypto:Tokens         0.8 ETH {1500.0 USD, 2022-06-02}
</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th>Account<th>Date<th>Units<th>Cost Total<th>Label<tbody><tr><td>Assets:Crypto:Tokens<td>2022-01-02<td>2.00 ETH<td>2200.00 USD<td>None<tr><td>Assets:Crypto:Tokens<td>2022-03-02<td>1.50 ETH<td>3200.00 USD<td>None<tr><td>Assets:Crypto:Tokens<td>2022-06-02<td>0.80 ETH<td>1200.00 USD<td>None</table></div><p>If you were to sell 1 ETH at the current price which ‚Äúcoin(s)‚Äù would you sell? The method by which you choose lots to be used is called the ‚Äúbooking method‚Äù and depends on your taxs laws. Some countries give you more freedom to choose and some less. There can also be differences between what booking rules private individuals vs. corporations can use.</p><h4 id="fifo-first-in-first-out"><span class="mr-2">FIFO (First In First Out)</span><a href="#fifo-first-in-first-out" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The ‚ÄúFirst In First Out‚Äù booking method, dictates that the oldest lots are to be used first and is one of the most common booking methods. This method is applicable in both the US and Germany and is supported by beancount of the box:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:Tokens "FIFO"
2022-01-01 open Assets:Crypto:NFTs

2022-01-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -2,200.00 USD
    Assets:Crypto:Tokens                        2.00 ETH {}

2022-03-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -3,300.00 USD
    Assets:Crypto:Tokens                        1.50 ETH {}


2022-06-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -1,200.00 USD
    Assets:Crypto:Tokens                        0.8 ETH {}

2022-09-13 open Income:Crypto:Gains-PnL
2022-09-13 * "not-FTX" "Sell some ETH"
    Assets:Crypto:Tokens                       -1.00 ETH {}
    Assets:Cash:Exchange-A                  1,717.80 USD
    Income:Crypto:Gains-PnL
</pre></table></code></div></div><p>The booking method is defined next to the account when it‚Äôs created. When you dispose of some assets the curly braces select which lot you‚Äôre selling. This allows you to pick specific lots / coins based on the date, cost or label. If you have a booking method configured you can leave the lot selector empty and beancount will automatically pick the right one for you and fill out the details:</p><div file="Beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>&gt; bean-report Main.beancount print

2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:Tokens                             "FIFO"
2022-01-01 open Assets:Crypto:NFTs

2022-01-02 * "Simple Trade"
  Assets:Cash:Exchange-A  -2200.00 USD
  Assets:Crypto:Tokens        2.00 ETH {1100 USD, 2022-01-02}

2022-03-02 * "Simple Trade"
  Assets:Cash:Exchange-A  -3300.00 USD
  Assets:Crypto:Tokens        1.50 ETH {2200 USD, 2022-03-02}

2022-06-02 * "Simple Trade"
  Assets:Cash:Exchange-A  -1200.00 USD
  Assets:Crypto:Tokens         0.8 ETH {1500.0 USD, 2022-06-02}

2022-09-13 open Income:Crypto:Gains-PnL

2022-09-13 * "not-FTX" "Sell some ETH"
  Assets:Crypto:Tokens       -1.00 ETH {1100 USD, 2022-01-02}
  Assets:Cash:Exchange-A   1717.80 USD
  Income:Crypto:Gains-PnL  -617.80 USD
</pre></table></code></div></div><p>Your inventory is then also adjusted automatically:</p><div class="table-wrapper"><table><thead><tr><th>Account<th>Date<th>Units<th>Cost Total<th>Label<tbody><tr><td>Assets:Crypto:Tokens<td>2022-01-02<td><strong>1.00 ETH</strong><td>2200.00 USD<td>None<tr><td>Assets:Crypto:Tokens<td>2022-03-02<td>1.50 ETH<td>3200.00 USD<td>None<tr><td>Assets:Crypto:Tokens<td>2022-06-02<td>0.80 ETH<td>1200.00 USD<td>None</table></div><h4 id="lifo-last-in-first-out"><span class="mr-2">LIFO (Last In First Out)</span><a href="#lifo-last-in-first-out" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Similar to FIFO the LIFO rule dictates that the last lot i.e. the newest must be used first. This rule is also available in beancount and can be specified just like the FIFO rule:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Crypto:Tokens "LIFO"
</pre></table></code></div></div><h4 id="average-cost-booking"><span class="mr-2">Average Cost Booking</span><a href="#average-cost-booking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Unlike FIFO and LIFO, average cost booking requires you to essentially merge all lots into one at their average price. This method is used in the UK and Canada. This method is not yet supported by beancount out-of-the-box and requires manual lot recreation or writing a custom plugin:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:Tokens
2022-01-01 open Assets:Crypto:NFTs

2022-01-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -2,200.00 USD
    Assets:Crypto:Tokens                        2.00 ETH {}

2022-03-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -3,300.00 USD
    Assets:Crypto:Tokens                       -2.00 ETH {}
    Assets:Crypto:Tokens                        3.50 ETH {}


2022-06-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -1,200.00 USD
    Assets:Crypto:Tokens                       -3.50 ETH {}
    Assets:Crypto:Tokens                        4.30 ETH {}

2022-09-13 open Income:Crypto:Gains-PnL
2022-09-13 * "not-FTX" "Sell some ETH"
    Assets:Crypto:Tokens                       -1.00 ETH {}
    Assets:Cash:Exchange-A                  1,717.80 USD
    Income:Crypto:Gains-PnL
</pre></table></code></div></div><h4 id="specific-id--hifo-highest-in-first-out"><span class="mr-2">Specific ID &amp; HIFO (Highest In First Out)</span><a href="#specific-id--hifo-highest-in-first-out" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>If you‚Äôre in the US and you document your purchases very well (which is something that beancount will enable you to do), then you can apply the ‚ÄúSpecific ID‚Äù method<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>. This method allows you to choose <strong>any lot</strong> from your inventory when you sell. This allows you to come up with and use essentially any booking method you want, including the HIFO ‚Äúhighest in first out‚Äù method. The HIFO method dictates that you sell your most expensive lots first, this minimizes your realized gains or maximizes your realized losses, allowing you to minimize your tax burden when you sell.</p><p>Selecting custom lots is supported by beancount but methods like HIFO are not supported out-of-the-box and would either have to be done manually or via a custom plugin:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:Tokens
2022-01-01 open Assets:Crypto:NFTs

2022-01-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -2,200.00 USD
    Assets:Crypto:Tokens                        2.00 ETH {}

2022-03-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -3,300.00 USD
    Assets:Crypto:Tokens                        1.50 ETH {}


2022-06-02 * "Simple Trade"
    Assets:Cash:Exchange-A                 -1,200.00 USD
    Assets:Crypto:Tokens                        0.8 ETH {}

2022-09-13 open Income:Crypto:Gains-PnL
2022-09-13 * "not-FTX" "Sell some ETH"
    Assets:Crypto:Tokens                       -1.00 ETH {2022-03-02}
    Assets:Cash:Exchange-A                  1,717.80 USD
    Income:Crypto:Gains-PnL
</pre></table></code></div></div><p>If you‚Äôre manually selecting lots you have to make sure that your selection in the curly brackets <code class="language-plaintext highlighter-rouge">{</code> <code class="language-plaintext highlighter-rouge">}</code> is not ambiguous</p><h4 id="universal-vs-per-account-booking"><span class="mr-2">Universal vs. Per Account Booking</span><a href="#universal-vs-per-account-booking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>FIFO, LIFO and HIFO all require you to keep track of inventory you can book from. While you could keep track of one inventory for every account (Exchange A, Exchange B, Wallet 1, Wallet 2, etc.) this separation starts to break down when you transfer assets between locations. That‚Äôs why for crypto it‚Äôs usually more practical to keep track of a single inventory and do ‚Äúuniversal booking‚Äù meaning regardless where you buy / sell your assets you‚Äôre always booking from the</p><h2 id="defi-accounting"><span class="mr-2">DeFi Accounting</span><a href="#defi-accounting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we‚Äôve covered the basics, understand booking methods and how to account for basic trades I wanted to go through some more examples related to DeFi and some other smaller nuances.</p><h3 id="profit--loss-accounts-pnl-accounts"><span class="mr-2">Profit &amp; Loss Accounts (PnL Accounts)</span><a href="#profit--loss-accounts-pnl-accounts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>For gains related to crypto or other trading activity I create what I like to call ‚ÄúPnL accounts‚Äù they‚Äôre accounts where book all gains and losses of a certain type so that I can immediately see my net gain and don‚Äôt have to check whether or not a given trade realized a loss or gain:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>2022-01-01 open Assets:Cash:Exchange-A
2022-01-01 open Assets:Crypto:Tokens "FIFO"
2022-01-01 open Assets:Crypto:NFTs
2022-01-01 open Income:Crypto:Gains-PnL

2022-01-01 * "NFT Purchase"
    Assets:Cash:Exchange-A
    Assets:Crypto:NFTs                          1 GOBBLER {4,000.00 USD, "id:400"}
    Assets:Crypto:NFTs                          1 GOBBLER {3,900.00 USD, "id:401"}


2022-03-01 * "ArtGobblers" "Sale"
    Assets:Crypto:NFTs                         -1 GOBBLER {"id:401"}
    Assets:Cash:Exchange-A                  2,000.00 USD
    Income:Crypto:Gains-PnL

2022-08-01 * "DCA into ETH"
    Assets:Cash:Exchange-A                   -500.00 USD
    Assets:Crypto:Tokens                        0.482 ETH {}

; Includes Fee
2022-11-13 * "Uniswap" "Get some DAI"
    Assets:Crypto:Tokens                       -0.202838 ETH {}
    Assets:Crypto:Tokens                      322.113821 DAI {1.00 USD}
    Income:Crypto:Gains-PnL
</pre></table></code></div></div><p>This allows me to easily isolate and track my profit (or losses):</p><div file="(cmd output of) bean-report Main.beancount journal -a Income:Crypto:Gains-PnL -b -x" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="(cmd output of) bean-report Main.beancount journal -a Income:Crypto:Gains-PnL -b -x"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>2022-01-01 open  Income:Crypto:Gains-PnL
2022-03-01 *     ArtGobblers | Sale          1900.00 USD   1900.00 USD
2022-11-13 *     Uniswap | Get some DAI      -111.70 USD   1788.30 USD
</pre></table></code></div></div><p>The above overview can also be seen in fava by clicking on ‚ÄúGo to account‚Äù and selecting your PnL account.</p><p>However if you want to breakdown your losses and gains into separate accounts you can do so. You could even automate the process with a plugin. Making a plugin is actually relatively easy, check out the <a href="https://beancount.github.io/docs/beancount_scripting_plugins.html">beancount docs on how to script plugins</a>.</p><h3 id="spread-slippage--fees"><span class="mr-2">Spread, Slippage &amp; Fees</span><a href="#spread-slippage--fees" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When you perform trades on exchanges, centralized or decentralized there are different factors that reduce the value you‚Äôre able to get out of a trade. By ‚Äúfees‚Äù I‚Äôm referring to explicit network and/or exchange fees that are deducted from your account in exchange for facilitating the trade. Spreads and slippage on the other hand, while not the same thing, for the sake of accounting they may as well be as they both represent deviations from your practical price and the actual market price.</p><p>There are two approaches to account for these trade impacts:</p><ol><li>Direct accounting: calculate fees and slippage / spread and put them into respective loss accounts<li>Cost basis inclusion: add any cost associated with a trade to the cost basis of the output asset</ol><p>Not only is the second option simpler, the first may be incorrect depending on your tax laws. You see trading fees and price difference costs (slippage, spreads) are usually tax deductible however if you account them directly by puting them to an expense account, you‚Äôre moving forward the time of that deduction. To make it simpler let‚Äôs just look at a simple example with an exchange that charges an unrealistic 25% fee:</p><div file="Main.beancount (direct fee inclusion)" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount (direct fee inclusion)"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>2021-01-01 open Assets:Cash:Exchange-A
2021-01-01 open Expenses:Fees:Exchange-A
2021-01-01 open Assets:Crypto:Tokens                             "FIFO"
2021-01-01 open Assets:Crypto:NFTs
2021-01-01 open Income:Crypto:Gains-PnL

2021-06-13 * "ETH DCA"
  Assets:Cash:Exchange-A    -2500.00 USD
  Expenses:Fees:Exchange-A    500.00 USD
  Assets:Crypto:Tokens          2.00 ETH {1000 USD, 2021-06-13}

2022-07-14 * "ETH Sale"
  Assets:Crypto:Tokens       -0.5 ETH {1000 USD, 2021-06-13}
  Assets:Cash:Exchange-A   450.00 USD
  Income:Crypto:Gains-PnL   50.00 USD
</pre></table></code></div></div><p>Versus Cost inclusion:</p><div file="Main.beancount (cost inclusion)" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount (cost inclusion)"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>2021-06-13 * "ETH DCA"
  Assets:Cash:Exchange-A  -2500.00 USD
  Assets:Crypto:Tokens        2.00 ETH {1250 USD, 2021-06-13}

2022-07-14 * "ETH Sale"
  Assets:Crypto:Tokens       -0.5 ETH {1250 USD, 2021-06-13}
  Assets:Cash:Exchange-A   450.00 USD
  Income:Crypto:Gains-PnL  175.00 USD
</pre></table></code></div></div><p>You see in the direct inclusion scenario the full expenses is booked in the first year (2021) although that loss hasn‚Äôt necessarily had a material impact yet. In the second scenario 1/4 of the fee is included as part of the loss because 1/4 of the original ETH amount is sold, the fee is implicitly accounted for when a gain / loss from the affected amount is actually realized.</p><p>Which method you can and should use really depends on your tax laws. Accounting the expense immediately can help reduce your tax bill but may also have you understate your net profit or overstate your net loss. For these kinds of details it‚Äôs usually best to consult a professional as they should be able to answer such questions quite easily and quickly if they have accounting / tax expertise.</p><h3 id="crypto-income"><span class="mr-2">Crypto Income</span><a href="#crypto-income" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Whether it‚Äôs freelance work or interest, income denominated in crypto is relatively easy to account, similar to a trade book the crypto to your assets at the current market price and the relevant income account as source of the funds:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>2021-01-01 open Assets:Crypto:Tokens "FIFO"
2021-01-01 open Income:Crypto:Gains-PnL
2021-01-01 open Income:Crypto:Interest
2021-01-01 open Income:Freelance:Consulting

2022-03-03 * "Bob" "Payment of invoice #1001"
    Income:Freelance:Consulting
    Assets:Crypto:Tokens                        1.7623 ETH {2,966.84 USD}

; Withdrawal of original collateral not booked because you owned it before and still own it after the withdrawal
; Only the change, the interest is accounted
2022-07-31 * "Aave" "Withdrawal of collateral + interest"
    Income:Crypto:Interest
    Assets:Crypto:Tokens                       34.110 DAI {0.996 USD}
</pre></table></code></div></div><blockquote class="prompt-danger"><div><p><strong>Be Aware Of Income Separation</strong></p><p>Depending on your tax laws you may <strong>not be able</strong> to deduct losses from crypto against income earned from your fixed job or freelance work because they‚Äôre classed as different types of income.</p><p>This means that if you get paid in crypto and the price drops by 50% you may have to pay taxes on the full value of the originially received amount as it was personal income while only being able to deduct the 50% price fall from other crypto gains.</p><p>If you get paid in crypto it‚Äôs vital you inform yourself to what extent there‚Äôs a separation so that you can sell and set aside received crypto if necessary.</p></div></blockquote><h3 id="liquidity-tokens"><span class="mr-2">Liquidity Tokens</span><a href="#liquidity-tokens" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>LP Tokens are the fungible or non-fungible (NFT) tokens you get when providing liquidity to DEXs like Uniswap, Sushiswap or Pancakeswap. The tax implications of providing liquidity is hard to determine in most of the world as there doesn‚Äôt really exist an equivalent instrument in the TradFi world that tax authorities or advisors could really compare to.</p><p><img data-src="/assets/images/univ3-lp-token.svg" alt="Uniswap V3 LP NFT" data-proofer-ignore></p><p>But looking at how they work we can at least try to account the intuitively:</p><ol><li>You give up 1 or 2 assets<li>You receive another asset in return (the LP token/s)<li>While you hold the LP asset it‚Äôs price can develop independently of the assets, accruing fees and going up or down in value based on the underlying<li>When you get rid of the LP asset you receive 1 or 2 assets in different proprtions</ol><p>Based on these circumstances I think it‚Äôs fair to say that when you provide liquidity you‚Äôre disposing i.e. practically selling your tokens for the LP asset:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>2021-01-01 open Assets:Crypto:Tokens "FIFO"
2021-01-01 open Income:Crypto:Gains-PnL
2021-01-01 open Income:Crypto:Interest
2021-01-01 open Income:Freelance:Consulting
2021-01-01 open Equity:Opening-Balances


2022-09-03 * "Opening Transaction"
    Assets:Crypto:Tokens                    6,000.00 DAI {1.0001 USD}
    Assets:Crypto:Tokens                        4.23 ETH {1,720.00 USD}
    Equity:Opening-Balances


2022-11-01 open Assets:Crypto:LP "FIFO"


; price directive tells beancount about prices
2022-11-01 price ETH 1,565.00 USD

; Fee cost included
2022-11-01 * "Sushiswap" "Provide ETH / DAI liquidity"
    Assets:Crypto:Tokens                   -3,000.00 DAI {}
    Assets:Crypto:Tokens                       -1.90384929272910 ETH {}
    Assets:Crypto:LP                          629.37 SUSHI-LP {{5979.52 USD, "DAI-ETH"}}
    Income:Crypto:Gains-PnL
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>You can indicate the total cost of the lot rather than the cost / unit by using double curly braces:</p><ul><li><code class="language-plaintext highlighter-rouge">2.0 ETH {1,200.00 USD}</code>: Book 2 ETH at a cost of 1,200.00 USD each<li><code class="language-plaintext highlighter-rouge">3.0 ETH {{3,300.00 USD}}</code>: Book 3 ETH at a total cost of 3,300.00 USD or 1,100.00 USD each</ul></div></blockquote><p>When you withdraw your underlying from your LP position you can then book the disposal of the LP asset although I‚Äôd put that into a separate LP account. Accounting this can be a bit tricky if you consider that to withdraw from your LP you‚Äôre also spending gas and therefore desposing of ETH, booking a potentially separate loss / gain:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>2022-12-04 price ETH 1,242.161 USD

2022-12-04 open Assets:Temp ; holds fee value
2022-12-04 * "Sushiswap" "Withdraw liquidity (network fee)"
    Assets:Crypto:Tokens                       -0.003481 ETH {}
    Assets:Temp                                 4.324 USD ; Fee value
    Income:Crypto:Gains-PnL ; Profit / Loss from disposing ETH for fee

2022-12-04 open Income:Crypto:LP
2022-12-04 * "Sushiswap" "Withdraw liquidity withdrawal"
    Assets:Crypto:LP                         -629.3700 SUSHI-LP {"DAI-ETH"}
    Assets:Temp                                -4.3240 USD
    Assets:Crypto:Tokens                    3,400.0000 DAI {1.00 USD}
    Assets:Crypto:Tokens                        2.7375 ETH {1,242.161 USD}
    Income:Crypto:LP
</pre></table></code></div></div><p>Note that I split the single transaction (LP withdrawal) over two entries so that I can leverage beancount‚Äôs auto-balance feature to calculate the P/L on the ETH and the LP tokens, furthermore for the sake of simplicity I‚Äôm not following my own rule of including the fee in the cost of the output.</p><h3 id="-margin--shorting"><span class="mr-2">üìâ Margin &amp; Shorting</span><a href="#-margin--shorting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote class="prompt-info"><div><p>Before proceeding with this section where I show you how I‚Äôd account margin &amp; shorting related transactions I‚Äôd recommend you pause here, and as an exercise try to record your own or example transactions in beancount or on paper (opening a short, closing, liquidation). Break it down step by step, what am I putting into this transaction, what am I getting out? What cost basis is associated? Do my transactions balance and have I forgotten to book income / expenses?</p></div></blockquote><p>Here I‚Äôll talk mainly about margin, leverage and shorting in the sense where you‚Äôre actually borrowing assets to some degree. If you‚Äôre leveraged derivatives such as Perps or Inverse tokens that don‚Äôt directly require debt on your part you can use the approaches described above to account for your transactions.</p><h4 id="borrowing-usd"><span class="mr-2">Borrowing USD</span><a href="#borrowing-usd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The first step when leverage trading or shorting is borrowing. Borrowing allows you to basically ‚Äúplay with someone else‚Äôs money‚Äù paying them back once your trade was successful or degraded to the point where the funds are called back, typically in a process called ‚Äúliquidation‚Äù.</p><p>Thinking of the basics borrowing has two sides: you get something (book to assets) and you create an obligation to pay something back (book to liabilities):</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>2023-01-01 * "Exchange-A" "Borrow 1,000 USD to margin trade"
  Liabilities:Margin:Exchange-A     -1,000.00 USD
  Assets:Cash:Exchange-A             1,000.00 USD

</pre></table></code></div></div><p>Now if you trade with those borrowed assets you can book them as normal, buying and selling different cryptos, tracking the cost basis etc.</p><h4 id="repaying-usd"><span class="mr-2">Repaying USD</span><a href="#repaying-usd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Similar to the borrow transaction you simply book the same accounts but in reverse, adding a positive amount to your liabilities and deducting from your asset accounts. To account for interest you simply book an ‚Äúinterest expense‚Äù account:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>2023-01-01 * "Exchange-A" "Borrow 1,000 USD to margin trade"
  Assets:Cash:Exchange-A                -1,003.00 USD
  Liabilities:Margin:Exchange-A          1,000.00 USD
  Expenses:Interest:Margin:Exchange-A        3.00 USD

</pre></table></code></div></div><h4 id="borrowing-non-base-currency-assets"><span class="mr-2">Borrowing Non-Base Currency Assets</span><a href="#borrowing-non-base-currency-assets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>If you short crypto the old school way or are just borrowing a foreign stable coin on a decentralized lending protocol you‚Äôll have to account your liabilities slightly differently. Since your core ledger is tracked in another asset you may actually realize a loss / gain once you repay your debt because of a difference in price. Let‚Äôs you were shorting LUNA and you borrowed and sold 1,000 LUNA at a price of 100 USD / LUNA and you later bought it back and repaid that debt after it dropped to 80 USD, that‚Äôd be a gain of 20 USD / LUNA that you have to somehow account. This can achieved by also tracking the ‚Äúcost basis‚Äù of your debt this is nearly identical to what you would do for assets although a bit more counterintuitive. The ‚Äúcost basis‚Äù is not the value you spent to acquire the debt but instead the value of the debt when it was created:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>2022-06-01 open Liabilities:Crypto:Exchange-A "FIFO"
2022-06-01 open Assets:Crypto:Exchange-A "FIFO"
2022-06-01 open Expenses:Crypto:Trading-Fees:Exchange-A

2022-06-01 * "Exchange-A" "Borrow LUNA for short"
  Liabilities:Crypto:Exchange-A     -1,000.00 LUNA {100.00 USD}
  Assets:Crypto:Exchange-A           1,000.00 LUNA {100.00 USD}

2022-06-01 * "Exchange-A" "Sell borrowed LUNA"
  Assets:Crypto:Exchange-A                    -1,000.00 LUNA {}
  Assets:Cash:Exchange-A                      99,987.00 USD
  Expenses:Crypto:Trading-Fees:Exchange-A         13.00 USD

</pre></table></code></div></div><p>Note that liability accounts that track non-base currency assets also need a booking rule as you may be borrowing in several batches over time at different prices and need to know how to account the value change of your debt.</p><h4 id="repaying-crypto"><span class="mr-2">Repaying Crypto</span><a href="#repaying-crypto" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Closing the LUNA short from above you‚Äôd book at 80 USD a transactions as follows:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>2022-07-01 * "Exchange-A" "Buy Back LUNA"
  Assets:Cash:Exchange-A                     -80,087.00 USD
  Assets:Crypto:Exchange-A                     1,001.00 LUNA {80.00 USD}
  Expenses:Crypto:Trading-Fees:Exchange-A          7.00 USD

2022-07-01 * "Exchange-A" "Repay LUNA loan + 1 LUNA of interest"
  Assets:Crypto:Exchange-A             -1,001.00 LUNA {}
  Liabilities:Crypto:Exchange-A         1,000.00 LUNA {}
  Income:Crypto:Debt-PnL              -20,000.00 USD
  Expenses:Interest:Margin:Exchange-A      80.00 USD // Value of 1 LUNA of interest just bought added to expenses
</pre></table></code></div></div><h4 id="liquidation"><span class="mr-2">Liquidation</span><a href="#liquidation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Liquidation is nearly identical to repayment except you may have to pay a liquidation penalty on top of the value of the now increased debt, realizing both a loss because of the appreciation of your liability and expense in the form of the liquidation penalty:</p><div file="Main.beancount" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Main.beancount"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>; Alternative Universe where LUNA went to 200 USD

2022-07-01 * "Exchange-A" "Liquidation at 200 USD / LUNA + 5% penatly and 4 LUNA interest"
  Assets:Cash:Exchange-A             -210,800.00 USD
  Liabilities:Crypto:Exchange-A         1,000.00 LUNA {}
  Expenses:Interest:Margin:Exchange-A     800.00 USD
  Income:Crypto:Debt-PnL              100,000.00 USD
  ; 5% on the 200k worth of LUNA debt
  Expenses:Liquidation:Exchange-A      10,000.00 USD

</pre></table></code></div></div><h2 id="basic-tax-optimization"><span class="mr-2">Basic Tax Optimization</span><a href="#basic-tax-optimization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we have the tools and some examples to account basically any crypto transaction let‚Äôs go through some tax tips that should apply to most jurisidictions. However before we dive in I‚Äôd refer you to the disclaimer and consulting professionals sections again, this is not tax / legal advice but merely educational examples of tax strategies that may or <strong>may not</strong> work or even be legal depending on where you live and file your taxes. There can be very subtle but important differences between countries based on your precise circumstances. Furthermore professional tax advisors and accountants should be able to advise on other strategies that are better or actually suited to your circumstances.</p><h3 id="hodl--borrow"><span class="mr-2">HODL &amp; Borrow</span><a href="#hodl--borrow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Unless your country has some type of wealth / property tax on merely having valuable assets only <em>realized</em> gains are taxed. What this means is that if you buy a coin and it e.g. goes up 1000x over time turning your $ 10,000 investment into $ 10M that $ 9.99M won‚Äôt actually be taxable until you sell those coins for another or fiat.</p><blockquote class="prompt-warning"><div><p>Don‚Äôt try to avoid paying taxes by selling your coins for other coins, or spending the tokens directly on goods or services via e.g. a crypto card because most jurisidictions count any disposal as a realization of your gains. Meaning if you pay e.g. for a watch that costs 15k with coins you purchased at a value of 1.5k you‚Äôll owe the government taxes on the 13.5k realized gain.</p></div></blockquote><p>So great, you have coins that have gone up in value but you can‚Äôt / don‚Äôt want to sell them to avoid taxes, what‚Äôs the point of having those juicy gains if you can‚Äôt spend them, right? Well that‚Äôs where the second part comes in. Instead of selling to access the value of your assets you can borrow against them, either on exchanges in the form of margin loans, lending protocols or even directly with people OTC depending on the asset and what the amount you‚Äôre borrowing against is. In most jurisidictions this doesn‚Äôt count as a sale because you technically still own the asset, you‚Äôve just deposited it somewhere as collateral, as long as you pay the interest and don‚Äôt default on the loan you don‚Äôt realize a gain. In fact if you have good collateral you may never have to directly repay the loan as you could continue to refinance as the value of your asset appreciates.</p><p><strong>Example:</strong></p><p>You have 1,000.00 ETH you bought back in the day for $ 20 a piece and you want to get yourself a nice car for $ 60k. Instead of selling that ETH you go to an institution or lending platform and deposit the more than $ 1M worth of ETH as collateral, borrowing $ 60k against it. Not only will you not realize a gain (again depends on your jurisidiction) the interest on that loan is likely very low and definitely much lower than any consumer credit card debt. A win-win.</p><h3 id="long-term-vs-short-term-gains"><span class="mr-2">Long-term vs. Short-term Gains</span><a href="#long-term-vs-short-term-gains" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Extending the HODL &amp; borrow strategy you can also save a lot in taxes by being aware of your long-term vs. short-term profit taxes. You see most jurisidictions have a different tax rate for profits that are made from assets that were held for shorter periods and profits from assets that were held for longer, this is meant to discourage speculation. In Germany for example, short-term gains from crypto held less than 1 year are taxed at your personal income tax rate which very easily reaches 42%. However if you hold your crypto for more than a year any gains are completely tax free (doesn‚Äôt apply to all coins though and only for private individuals not companies). The US seems to have a similar rule whereby short-term crypto sales count as a ‚Äúshort-term capital gain‚Äù and long-term sales count as ‚Äúlong-term capital gain‚Äù.<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup></p><p>This is why systematically tracking your crypto transactions can be very useful so that you can more easily know whether you can decrease your tax burden by simply waiting a bit longer before selling.</p><h3 id="tax-loss-harvesting"><span class="mr-2">Tax Loss Harvesting</span><a href="#tax-loss-harvesting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Tax loss harvesting is strategy whereby you strategically sell positions at a loss to offset your net gain for a year and reducing your tax burden. This can be the silver lining in the those shitty NFT and dog coin purchases, they could at least allow you to reduce your taxable gain. Selling earlier at a loss is also useful because jurisidictions that differentiate between long-term and short-term gains usually do the same for losses whereby long-term losses are only deductible from long-term gains and short-term losses from short-term gains.</p><p><strong>Example:</strong></p><p>It‚Äôs 2022 and the tax year is ending in 1 month, throughout the year I realized $ 5,000.00 of short-term gains taxed at 30% and $ 3,000.00 of long-term gains taxed at 10%. The cutoff for long-term / short-term is 1 year. I also still hold an NFT that rugpulled right after launch almost a year back, 350 days. At the time I bought the NFT I aped in with ETH that was at the time worth $ 2,000.00. Now there‚Äôs no trading volume, no active bids, the project is basically dead, meaning a current value of 0$ or a realized loss of $ 2,000.00 if I were to sell it.</p><p>If I don‚Äôt sell the NFT I‚Äôd have to pay <code class="language-plaintext highlighter-rouge">5000 x 30% + 3000 * 10%</code> = $ 1,800.00 in taxes. If I wait too long to sell the NFT until it‚Äôs been a year since the original aquisition it‚Äôll only count against my long-term gains meaning I‚Äôd pay <code class="language-plaintext highlighter-rouge">5000 x 30% + (3000 - 2000) * 10%</code> = $ 1,600.00 in taxes. $ 200.00 In savings are good but it could be even better. If I sell the NFT immediately it would just still count to my short-term gains, reducing my tax burden to <code class="language-plaintext highlighter-rouge">(5000 - 2000) x 30% + 3000 * 10%</code> = $ 1,200.00, $ 600.00 in savings!</p><p>Beyond simply reducing your tax burden you can also lower the cost basis of the asset if you wish to keep it by selling and then re-buying it at a similar price, as this will realize a loss and lower your cost basis because you bought back in at a lower price. Done right this can move losses into your short-term gains and move the future gain to your long-term side.</p><blockquote class="prompt-warning"><div><p>Some jurisidictions have rules that prevent you from legally accounting losses if you replaces the asset i.e. buy back-in shortly after you sold it so it is highly advised you do some research before doing this. The US for example has a rule that prevents this called the ‚Äúwash sale‚Äù rule that prevents you from accounting losses for securities such as stocks and bonds that you buy back in less than 30 days.</p></div></blockquote><h3 id="trading-llc"><span class="mr-2">Trading LLC</span><a href="#trading-llc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>Just create an LLC bro</p></blockquote><p>As I briefly touched on before depending on your tax code different types of income may have to be accounted and taxed differently. What this can for example mean is that if you‚Äôre a freelancer getting paid in crypto the value upon receival may be taxed as normal income while a realized loss from the coin itself may only count as capital gains, the may not be able to deduct the one from the other.</p><p>This is where a ‚ÄúTrading LLC‚Äù comes in. In case you didn‚Äôt know in almost all jurisidictions of the world buisnesses and individuals are taxed differently and have different accounting rules that apply to them. However you don‚Äôt have to have a ‚Äúreal company‚Äù to be able to take advantage of the differences in rules. In most capitalist countries it‚Äôs relatively easy and not that expensive for anyone to create a buisness entity. A buisness entity is a ‚Äúvirtual‚Äù legal person separate from yourself as a private individual but controlled by you. Almost how a smart contract is different to an EOA / user wallet. A company is an imaginary concept, it‚Äôs a ‚Äúlegal ritual‚Äù that has to be enacted by you, typically together with a lawyer or notary that allow to create a new ‚Äúperson‚Äù in the legal system. It‚Äôs less complicated than it sounds but there are several trade-offs to consider before creating one solely for the purposes of trading:</p><p><strong>Reporting requirements &amp; overhead</strong></p><p>Unlike your personal income statement filing for a company is usually more complex and expensive than just for yourself as it‚Äôs typically always done by a professional. This may not always be the case, in some countries it may easier to file taxes for a company than it is to do so privately</p><p><strong>Laws &amp; compliance</strong></p><p>Trading as a company may require you to get additional licenses from regulatory bodies if it‚Äôs a ‚Äúprotected‚Äù or ‚Äúreserved‚Äù activity in your country.</p><p><strong>Finacial separation</strong></p><p>While there are exceptions, buisness entities are typically separate <em>persons</em> with separate finances under the law so you can‚Äôt just freely transfer assets back and forth without certain tax or even legal implications.</p><p>For example, while a buisness entity may allow you to deduct gains and losses from different income streams going into the business from one another, any profits are ‚Äústuck‚Äù in the company. Legally taking money out of your business may require you to issue a dividend or salary which will be taxed as capital gains or normal income, meaning you may end up paying more taxes (corporate tax + capital gains / income tax) than you if you were to just directly trade as private individual.</p><p><strong>KYC</strong></p><p>Trading on exchanges and other KYC‚Äôed platforms will also require you to do a separate registration, even more overhead.</p><h2 id="final-thoughts"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>While none of us want to pay our taxes the penalty for not doing so or doing so incorrectly can be quite severe. Understanding the basics of financial accounting and your local tax code will allow you to not only pay your taxes and sleep well at night but also give you better insight into your finances and finance in general.</p><p>I hope I was able to present the stereotypically boring subject of accounting and taxation in an engaging and valuable way. If you have any feedback or want to stay updated future finance / smart contract content you DM / follow me on <a href="https://twitter.com/real_philogy">Twitter</a>.</p><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p><a href="https://tokentax.co/blog/crypto-accounting-methods">Token Tax - Accounting methods</a>¬†<a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:2" role="doc-endnote"><p><a href="https://www.forbes.com/sites/shehanchandrasekera/2020/09/17/what-crypto-taxpayers-need-to-know-about-fifo-lifo-hifo-specific-id">Forbes - Article on crypto booking methods</a>¬†<a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:3" role="doc-endnote"><p><a href="https://www.investopedia.com/articles/personal-finance/101515/comparing-longterm-vs-shortterm-capital-gain-tax-rates.asp">Investopedia Long-Term vs. Short-Term Capital Gains</a>¬†<a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/acounting/'>acounting</a>, <a href='/categories/defi/'>DeFi</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/defi/" class="post-tag no-text-decoration" >DeFi</a> <a href="/tags/accounting/" class="post-tag no-text-decoration" >accounting</a> <a href="/tags/beancount/" class="post-tag no-text-decoration" >beancount</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Beancount%3A+DeFi+Accounting+For+Noobs+-+Philogy%27s+blog&url=https%3A%2F%2Fphilogy.github.io%2Fposts%2Fdefi-accounting-for-noobs%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fphilogy.github.io%2Fposts%2Fdefi-accounting-for-noobs%2F&text=Beancount%3A+DeFi+Accounting+For+Noobs+-+Philogy%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/curta-zsafe-writeup/">Curta CTF ZSafe Write-up</a><li><a href="/posts/paradigm-ctf-2022-write-up-collection/">Paradigm CTF 2022: Write-Up Collection</a><li><a href="/posts/quitting-dereg/">Quitting DeReg And What's Next</a><li><a href="/posts/defi-accounting-for-noobs/">Beancount: DeFi Accounting For Noobs</a><li><a href="/posts/selector-switches/">Constant Gas Function Dispatchers in the EVM</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/evm/">EVM</a> <a class="post-tag" href="/tags/smart-contracts/">smart contracts</a> <a class="post-tag" href="/tags/solidity/">solidity</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/accounting/">accounting</a> <a class="post-tag" href="/tags/beancount/">beancount</a> <a class="post-tag" href="/tags/defi/">DeFi</a> <a class="post-tag" href="/tags/development/">development</a> <a class="post-tag" href="/tags/personal/">personal</a></div></div></div><script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/curta-zsafe-writeup/"><div class="card-body"> <em class="small" data-ts="1705568820" data-df="ll" > Jan 18, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Curta CTF ZSafe Write-up</h3><div class="text-muted small"><p> This is a write-up for the Curta CTF ZSafe challenge. I initially didn‚Äôt submit a solution due to personal time constraints and issues with foundry scripts that made it impossible to submit directl...</p></div></div></a></div><div class="card"> <a href="/posts/quitting-dereg/"><div class="card-body"> <em class="small" data-ts="1700845080" data-df="ll" > Nov 24, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Quitting DeReg And What's Next</h3><div class="text-muted small"><p> Introduction For just over a year now I‚Äôve been working on a startup called ‚ÄúDeReg‚Äù, mostly full-time together with my amazing brother &amp;amp; co-founder Dimitri. Recently we have decided to stop th...</p></div></div></a></div><div class="card"> <a href="/posts/paradigm-ctf-2022-write-up-collection/"><div class="card-body"> <em class="small" data-ts="1661164560" data-df="ll" > Aug 22, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Paradigm CTF 2022: Write-Up Collection</h3><div class="text-muted small"><p> Intro I participated in the Paradigm CTF 2022 where I was personally able to solve 7 out of the 13 EVM-related challenges (not counting the PVP game 0xMonaco and external underhanded solidity conte...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/paradigm-ctf-2022-write-up-collection/" class="btn btn-outline-primary" prompt="Older"><p>Paradigm CTF 2022: Write-Up Collection</p></a> <a href="/posts/quitting-dereg/" class="btn btn-outline-primary" prompt="Newer"><p>Quitting DeReg And What's Next</p></a></div></div></div><footer class="pl-3 pr-3"><div class="row d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="col-6 footer-left width-full"><p class="mb-0"> ¬© 2026 <a href="/about">Philippe Dumonet</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="col-6 footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/evm/">EVM</a> <a class="post-tag" href="/tags/smart-contracts/">smart contracts</a> <a class="post-tag" href="/tags/solidity/">solidity</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/accounting/">accounting</a> <a class="post-tag" href="/tags/beancount/">beancount</a> <a class="post-tag" href="/tags/defi/">DeFi</a> <a class="post-tag" href="/tags/development/">development</a> <a class="post-tag" href="/tags/personal/">personal</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="/assets/lib/simple-jekyll-search-1.10.0/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/lib/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/lozad-1.16.0/lozad.min.js"></script> <script src="/assets/lib/clipboard-2.0.9/clipboard.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/dayjs.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/locale/en.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/lib/bootstrap-4.6.1/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
